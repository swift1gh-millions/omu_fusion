import React, { useState, useEffect } from 'react';\nimport { Button } from '../ui/Button';\nimport { GlassCard } from '../ui/GlassCard';\nimport ProductDebugService, { ProductDebugInfo } from '../../utils/productDebugService';\nimport { EnhancedProductService } from '../../utils/enhancedProductService';\nimport toast from 'react-hot-toast';\n\nexport const ProductDebugPanel: React.FC = () => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [logs, setLogs] = useState<string[]>([]);\n  const [healthCheck, setHealthCheck] = useState<{ healthy: boolean; issues: string[] } | null>(null);\n  const [products, setProducts] = useState<ProductDebugInfo[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    if (isOpen) {\n      loadDebugData();\n    }\n  }, [isOpen]);\n\n  const loadDebugData = async () => {\n    setIsLoading(true);\n    try {\n      // Get recent logs\n      const recentLogs = ProductDebugService.getRecentLogs(20);\n      setLogs(recentLogs);\n\n      // Run health check\n      const health = await ProductDebugService.checkSystemHealth();\n      setHealthCheck(health);\n\n      // Get products for analysis\n      const productsResponse = await EnhancedProductService.getProducts(\n        {},\n        { field: 'name', direction: 'asc' },\n        { pageSize: 100 }\n      );\n\n      const debugProducts: ProductDebugInfo[] = productsResponse.products.map(p => ({\n        id: p.id,\n        name: p.name,\n        category: p.category,\n        price: p.price,\n        stock: p.stock || 0,\n        isActive: p.isActive !== false,\n        hasImages: p.images && p.images.length > 0,\n        imageCount: p.images?.length || 0,\n        createdAt: p.createdAt,\n        updatedAt: p.updatedAt\n      }));\n\n      setProducts(debugProducts);\n      ProductDebugService.debugProductDisplay(debugProducts);\n    } catch (error) {\n      console.error('Failed to load debug data:', error);\n      toast.error('Failed to load debug information');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleClearCache = async () => {\n    try {\n      // Clear cache and reload data\n      const CacheService = await import('../../utils/cacheService');\n      CacheService.default.clearAll();\n      ProductDebugService.log('Cache cleared manually');\n      toast.success('Cache cleared successfully');\n      await loadDebugData();\n    } catch (error) {\n      toast.error('Failed to clear cache');\n    }\n  };\n\n  const handleGenerateReport = () => {\n    const report = ProductDebugService.generateDebugReport(products);\n    \n    // Create and download report\n    const blob = new Blob([report], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `product-debug-report-${new Date().toISOString().split('T')[0]}.txt`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n    \n    toast.success('Debug report downloaded');\n  };\n\n  const handleClearLogs = () => {\n    ProductDebugService.clearLogs();\n    setLogs([]);\n    toast.success('Logs cleared');\n  };\n\n  if (!isOpen) {\n    return (\n      <div className=\"fixed bottom-4 right-4 z-50\">\n        <Button\n          onClick={() => setIsOpen(true)}\n          className=\"bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 text-sm\"\n        >\n          üêõ Debug\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed bottom-4 right-4 z-50 w-96 max-h-96 overflow-hidden\">\n      <GlassCard className=\"p-4\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h3 className=\"text-lg font-semibold text-white\">Product Debug Panel</h3>\n          <Button\n            onClick={() => setIsOpen(false)}\n            className=\"bg-gray-600 hover:bg-gray-700 text-white px-2 py-1 text-xs\"\n          >\n            ‚úï\n          </Button>\n        </div>\n\n        {isLoading ? (\n          <div className=\"text-center py-4\">\n            <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-white mx-auto\"></div>\n            <p className=\"text-white mt-2 text-sm\">Loading debug data...</p>\n          </div>\n        ) : (\n          <div className=\"space-y-3 text-sm\">\n            {/* System Health */}\n            {healthCheck && (\n              <div>\n                <h4 className=\"font-medium text-white mb-1\">System Health</h4>\n                <div className={`p-2 rounded ${healthCheck.healthy ? 'bg-green-900/50' : 'bg-red-900/50'}`}>\n                  <p className={healthCheck.healthy ? 'text-green-300' : 'text-red-300'}>\n                    {healthCheck.healthy ? '‚úÖ System Healthy' : '‚ùå Issues Found'}\n                  </p>\n                  {healthCheck.issues.length > 0 && (\n                    <ul className=\"text-red-300 text-xs mt-1\">\n                      {healthCheck.issues.map((issue, i) => (\n                        <li key={i}>‚Ä¢ {issue}</li>\n                      ))}\n                    </ul>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Product Summary */}\n            <div>\n              <h4 className=\"font-medium text-white mb-1\">Product Summary</h4>\n              <div className=\"bg-blue-900/50 p-2 rounded text-blue-300\">\n                <p>Total: {products.length} products</p>\n                <p>Active: {products.filter(p => p.isActive).length}</p>\n                <p>With Images: {products.filter(p => p.hasImages).length}</p>\n                <p>Categories: {[...new Set(products.map(p => p.category))].length}</p>\n              </div>\n            </div>\n\n            {/* Issues */}\n            {(() => {\n              const noImages = products.filter(p => !p.hasImages);\n              const inactive = products.filter(p => !p.isActive);\n              const issues = [...(noImages.length > 0 ? [`${noImages.length} missing images`] : []),\n                             ...(inactive.length > 0 ? [`${inactive.length} inactive`] : [])];\n              \n              if (issues.length > 0) {\n                return (\n                  <div>\n                    <h4 className=\"font-medium text-white mb-1\">Issues Found</h4>\n                    <div className=\"bg-yellow-900/50 p-2 rounded text-yellow-300\">\n                      {issues.map((issue, i) => (\n                        <p key={i}>‚ö†Ô∏è {issue}</p>\n                      ))}\n                    </div>\n                  </div>\n                );\n              }\n              return null;\n            })()}\n\n            {/* Recent Logs */}\n            <div>\n              <h4 className=\"font-medium text-white mb-1\">Recent Logs ({logs.length})</h4>\n              <div className=\"bg-gray-900/50 p-2 rounded max-h-24 overflow-y-auto\">\n                {logs.length > 0 ? (\n                  <div className=\"space-y-1 text-xs text-gray-300\">\n                    {logs.slice(0, 5).map((log, i) => (\n                      <div key={i} className=\"truncate\" title={log}>\n                        {log}\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <p className=\"text-gray-400 text-xs\">No logs available</p>\n                )}\n              </div>\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex flex-wrap gap-2\">\n              <Button\n                onClick={loadDebugData}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 text-xs\"\n              >\n                üîÑ Refresh\n              </Button>\n              <Button\n                onClick={handleClearCache}\n                className=\"bg-purple-600 hover:bg-purple-700 text-white px-2 py-1 text-xs\"\n              >\n                üóëÔ∏è Clear Cache\n              </Button>\n              <Button\n                onClick={handleGenerateReport}\n                className=\"bg-green-600 hover:bg-green-700 text-white px-2 py-1 text-xs\"\n              >\n                üìÑ Export Report\n              </Button>\n              <Button\n                onClick={handleClearLogs}\n                className=\"bg-red-600 hover:bg-red-700 text-white px-2 py-1 text-xs\"\n              >\n                üßπ Clear Logs\n              </Button>\n            </div>\n          </div>\n        )}\n      </GlassCard>\n    </div>\n  );\n};\n\nexport default ProductDebugPanel;