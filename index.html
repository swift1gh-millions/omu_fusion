<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="cache-version" content="v2024-10-14-fix" />
    <link rel="icon" type="image/png" href="/logo_white.png" />
    <link rel="apple-touch-icon" href="/logo_white.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/logo_white.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/logo_white.png" />

    <!-- Early SW unregister + cache clear to avoid stale pages on custom domain -->
    <script>
      (function () {
        // Kill-switch: block any stray /api/analytics calls from old bundles
        try {
          const shouldBlock = (url) =>
            typeof url === "string" && url.indexOf("/api/analytics") !== -1;

          // Patch navigator.sendBeacon
          if (navigator.sendBeacon) {
            const origBeacon = navigator.sendBeacon.bind(navigator);
            navigator.sendBeacon = function (url, data) {
              if (shouldBlock(url)) {
                try { console.debug("[block] sendBeacon /api/analytics"); } catch {}
                return true; // pretend success
              }
              return origBeacon(url, data);
            };
          }

          // Patch fetch
          if (window.fetch) {
            const origFetch = window.fetch.bind(window);
            window.fetch = function (input, init) {
              const url = typeof input === "string" ? input : input?.url;
              if (shouldBlock(url)) {
                try { console.debug("[block] fetch /api/analytics"); } catch {}
                return Promise.resolve(new Response(null, { status: 204 }));
              }
              return origFetch(input, init);
            };
          }

          // Patch XMLHttpRequest
          if (window.XMLHttpRequest) {
            const OrigXHR = window.XMLHttpRequest;
            const open = OrigXHR.prototype.open;
            OrigXHR.prototype.open = function (method, url) {
              try {
                if (shouldBlock(url)) {
                  this.__blockedAnalytics = true;
                }
              } catch {}
              return open.apply(this, arguments);
            };
            const send = OrigXHR.prototype.send;
            OrigXHR.prototype.send = function (body) {
              if (this.__blockedAnalytics) {
                try { console.debug("[block] xhr /api/analytics"); } catch {}
                this.abort?.();
                return;
              }
              return send.apply(this, arguments);
            };
          }
        } catch (e) {
          try { console.warn("analytics kill-switch failed", e); } catch {}
        }

        if ("serviceWorker" in navigator) {
          navigator.serviceWorker.getRegistrations().then(function (regs) {
            regs.forEach(function (reg) {
              reg.unregister().catch(function () {});
            });
          });
        }
        if (window.caches) {
          caches.keys().then(function (keys) {
            keys.forEach(function (k) {
              caches.delete(k);
            });
          });
        }
      })();
    </script>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Caveat:wght@400;500;600;700&display=swap"
      rel="stylesheet" />

    <!-- Critical images are preloaded dynamically by PerformanceOptimizer -->

    <!-- Preconnect to external image sources -->
    <link rel="preconnect" href="https://images.unsplash.com" />
    <link rel="dns-prefetch" href="https://api.dicebear.com" />

    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="OMU FUTION - Premium Fashion & Lifestyle Brand" />
    <title>OMU FUTION - Premium Fashion</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script type="module" src="/src/index.tsx"></script>
  </body>
</html>
